{
    "collab_server" : "",
    "contents" : "source(\"C:/Users/Mark/Desktop/MSE_Plugin_Results_Plotting/share_tools.R\")\n\n###Biomass trajectories\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nplot_biomass_trajectories <- function(params){\n  \n  #Load up biomass reference file\n  biom_refs = read.csv(paste(params$plot.path,\"/Biom_refs.csv\",sep=''))\n  \n  #reset the director\n  setwd(paste(params$RootPath,\"\\\\Biomass\", sep=''))\n  \n\n  #get a list of all the files in the Biomass folder\n  #g <- list.files()\n  \n  plotting_params = initialise_plotting_params(\"Biomass\", params)\n\n  for(G in plotting_params$g){\n    \n    #Get the filename to be used to check whether yearly in name, to name files of plots and to add text to plots\n    FILENAME = substr(G,1,nchar(G)-4)\n    \n    #Check whether we should plot the yearly files or the monthly files\n    if(IsIncorrectFileType_YearlyMonthly(FILENAME, params$Plot_yearly_files)) next\n    \n    #Checks whether the group is designated to be plotted\n    DontPlot = TRUE\n    for(iGroup in params$Groups2Plot){\n      if (length(grep(paste(iGroup,\".csv\", sep=''), G, fixed=TRUE))==1) {\n        DontPlot=FALSE\n        break\n      }\n    }\n    if (DontPlot==TRUE) next\n\n    png(filename = paste(params$plot.path,\"\\\\OUTPUT_GROUP_FIGS\\\\\",FILENAME,\"_PERCS.png\",sep=\"\"), res=900, width=8, height=4, units='in')\n    \n    #Load the data from file\n    dat <- read.csv(G,skip=7, head=T)\n    \n    #Modify the values so that they are for the entire region\n    dat[,-c(1:4)] <- dat[,-c(1:4)]*570000\n    \n    \n    MDNS<- LOWS<- UPPS<- MEANS<- data.frame(year=plotting_params$TimeStepVals,row.names =plotting_params$TimeStepVals)\n    for(strat_i in 1:length(params$strats)){\n      \n      STRAT<-paste(params$strats[strat_i],sep=' ')\n      \n      #select subset of data\n      data2plot<- dat[dat$Strategy %in% STRAT,5:ncol(dat)]\n      \n      #quantiles for polygon plot\n      perc<-apply(data2plot,2, FUN=function(x){quantile(x,probs=c(0.025,0.5,0.975),na.rm=T)})\n      perc<-rbind(perc, apply(data2plot,2, FUN=mean) )\n      \n      #save percs\n      LOWS<- cbind(LOWS,perc[1,]);   names(LOWS)[ncol(LOWS)]<-STRAT\n      MDNS<- cbind(MDNS,perc[2,]);   names(MDNS)[ncol(MDNS)]<-STRAT\n      UPPS<- cbind(UPPS,perc[3,]);   names(UPPS)[ncol(UPPS)]<-STRAT\n      MEANS<- cbind(MEANS,perc[4,]);   names(MEANS)[ncol(MEANS)]<-STRAT\n      \n    }\n    \n    #Extract reference points\n    GroupName = dat[1,1]\n    bpa = read_biom_refs(biom_refs, GroupName, \"bpa\") * 570\n    blim = read_biom_refs(biom_refs, GroupName, \"blim\") * 570\n    \n    #now summary plot\n    #par(mar=c(5.1, 4.1, 4.1, 20), xpd=TRUE)\n    par(mar=c(5.1, 4.1, 4.1, 16), xpd=TRUE)\n    \n    #figure out what the highest value the y-axis needs to be\n    if(!is.na(bpa)){\n      y_upper = max(MEANS[,-1],UPPS[,-1],bpa)\n    } else {\n      y_upper = max(MEANS[,-1],UPPS[,-1])\n    }\n\n    #Plot a strategy results\n    if(params$PLOT_CONFIDENCE_INTERVALS){\n      plot(plotting_params$TimeStepVals,MEANS[,2],type='l',ylim=c(0,1.25*y_upper),lty=params$LTY[1],col=params$COL[1],ylab=\"relative biomass (t)\",xlab=\"year\",font=20,lwd=params$lineweight)\n      for(i in 3:ncol(MEANS)) {\n        lines(plotting_params$TimeStepVals,MEANS[,i],lty=params$LTY[(i-1)],col=params$COL[(i-1)],lwd=params$lineweight)\n      }\n      for(i in 2:(ncol(LOWS)-1)) {\n        #browser()\n        lines(plotting_params$TimeStepVals,LOWS[,i],lty=params$LTY[(i)],col=params$COL[(i-1)],lwd=params$lineweight*0.5)\n        lines(plotting_params$TimeStepVals,UPPS[,i],lty=params$LTY[(i)],col=params$COL[(i-1)],lwd=params$lineweight*0.5)\n      }\n    } else {\n      plot(plotting_params$TimeStepVals,MEANS[,2],type='l',ylim=c(0,1.25*y_upper),lty=params$LTY[1],col=params$COL[1],ylab=\"relative biomass (t)\",xlab=\"year\",font=20,lwd=params$lineweight)\n      for(i in 2:ncol(MEANS)) {\n        lines(plotting_params$TimeStepVals,MEANS[,i],lty=params$LTY[(i-1)],col=params$COL[(i-1)],lwd=params$lineweight)\n      }\n    }\n    \n    #plot the reference points\n    if(!is.na(bpa)){\n      lines(c(plotting_params$TimeStepVals[1],plotting_params$TimeStepVals[length(plotting_params$TimeStepVals)]),c(bpa,bpa),col=1,lwd=0.5, lty=3)\n      text(plotting_params$TimeStepVals[1]+1, bpa+0.05*y_upper, \"Bpa\", cex=0.5)\n    }\n    if(!is.na(blim)){\n      lines(c(plotting_params$TimeStepVals[1],plotting_params$TimeStepVals[length(plotting_params$TimeStepVals)]),c(blim,blim),col=1,lwd=0.5, lty=3)\n      text(plotting_params$TimeStepVals[1]+1, blim+0.05*y_upper, \"Blim\", cex=0.5)\n    }\n    \n    #Add a title and legend\n    title(c(\"Biomass trajectory (mean) by strategy\",FILENAME),font.main=20)#only individual plots\n    if(params$LEGEND){\n      legend('topright',params$strats,col = params$COL,lty =params$LTY,inset=c(-0.72,-0.2),lwd=1,text.font=3,pt.cex = 1,cex=0.5)\n    }\n    \n    graphics.off()\n    \n  }\n  graphics.off()\n}\n",
    "created" : 1480396600756.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2630903000",
    "id" : "E2D2E0AE",
    "lastKnownWriteTime" : 1480453373,
    "last_content_update" : 1480453373677,
    "path" : "C:/Users/Mark/Desktop/MSE_Plugin_Results_Plotting/B_Trajectories.R",
    "project_path" : "B_Trajectories.R",
    "properties" : {
    },
    "relative_order" : 12,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}