{
    "collab_server" : "",
    "contents" : "# INITIALISATION START ===============================================================================================\n\n#start with a clean sheet\nrm(list = ls())\n\n#load sources\n# source.folder.location = dirname(sys.frame(1)$ofile)\n# setwd(source.folder.location)\nsetwd(\"C:/Users/Mark/Desktop/MSE_Plugin_Results_Plotting\")\nsource(\"share_tools.R\")\nsource(\"initialisation.R\")\n#library(reshape)\nparams = initialise_params(\"0\")\n\n#root results path\n#root.plot =     \"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/North Sea MultiAnnual Plan/ResultsType1-4_220117/Plots/\"\n#root.results =  \"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/North Sea MultiAnnual Plan/ResultsType1-4_220117/Results/\"\n\nhcr.folders = c(\"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/NorthSea Model/2015 FINAL Key Run/DATA/HCRs/Type1_BmsytoZero\",\n                \"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/NorthSea Model/2015 FINAL Key Run/DATA/HCRs/Type2_BmsyBlimClifftoZero\",\n                \"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/NorthSea Model/2015 FINAL Key Run/DATA/HCRs/Type3_BmsytoZeroatBlim\",\n                \"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/NorthSea Model/2015 FINAL Key Run/DATA/HCRs/Type4_BmsyBlimClifftoFmin\")\n\ngroups.for.f.or.biomass = \"biomass\"\n\nbiomrefs_csv_inc_path = paste(params$plot.path,\"Biom_refs.csv\", sep=\"\")\n\n# INITIALISATION END ===============================================================================================\n\n\n\n# FUNCTION START  ===============================================================================================\n\nCreateBiomassFiveNumSum = function(){\n  \n  params = initialise_params(\"0\")\n  \n  unique.groups = LoadUniqueGroups(params$RootPath)\n  \n  # Loading reference points Blim and Bpa\n  biom_refs<-read.csv(biomrefs_csv_inc_path,sep=\",\", header=TRUE)\n  \n  summary.dt = data.table()\n  \n  #Configure the tables and variables for calculating percent <Blim & Bpa\n  SumBlim=list()  #The number of results that are above the Blim\n  percBlim=list() #The percentage of the results above Blim\n  SumBpa=list()   #The number of results that are above Bpa\n  percBpa=list()  #The percentage of the results above Bpa\n  df.perc.Blim = data.table()\n  df.perc.Bpa = data.table()\n  nUniqueStrategies = unique(params$strats)\n  \n  \n  #Create a data.table in which to compile all the tables from each file ready for saving to csv\n  dt.all = data.table()\n  \n  for(igroup in unique.groups)\n  {\n\n    #get a list of all the files in CatchTrajectories that are for \"AllFleets\"\n    biomass.file = GetFileName_ContainsStrings(FolderPath = paste(params$RootPath, \"Biomass/\", sep=\"\"),\n                                               Strings = c(igroup), WithPath=T)\n    \n    #Load the file\n    biomass = fread(biomass.file, skip=7, header=T)\n    \n    #Determine file is valid\n    if(!isNotAll(dt = biomass, col.data.starts = 4, val.to.check = -9999)) next\n    \n    #Calc mean last 5 year\n    biomass = calcLast5Year(biomass, \"biomass.last5yearmean\", 4, function.type = 2)\n    \n    #add a column with the group name - need this to merge with the strategy data.table\n    biomass = appendVariableToDataTable(dt=biomass, variable=igroup, variablename=\"GroupName\", beg=TRUE, end=FALSE)\n\n    #Modify the values so that they are for the entire region\n    biomass$biomass.last5yearmean = biomass$biomass.last5yearmean*params$Area/1000\n    \n    #add the group name to a column because I'm going to facet plot using this\n    biomass = appendVariableToDataTable(dt = biomass, variable = igroup, variablename = \"GroupName\", beg=TRUE, end=FALSE)\n    \n    #max.axis.x = max(biomass$biomass.last5yearmean)\n    \n    #Calc the percent below Bpa & Blim\n    bpa = biom_refs[biom_refs$Group==igroup,]$Bpa\n    blim = biom_refs[biom_refs$Group==igroup,]$Blim\n    biomass$below.bpa = biomass$biomass.last5yearmean<bpa\n    biomass$above.bpa = biomass$biomass.last5yearmean>=bpa\n    biomass$below.blim = biomass$biomass.last5yearmean<blim\n    biomass$above.blim = biomass$biomass.last5yearmean>=blim\n    \n    # biomass.percent.below.refpoints = biomass[,list(bpa = sum(below.bpa)/length(below.bpa), \n    #                                                 blim = sum(below.blim)/length(below.blim)), by=\"StrategyName\"]\n    # \n    #calculate the 5 number summary for each strategy\n    biomass.summary.by.strategy = biomass[,list(Min = min(biomass.last5yearmean), \n                                                LQ = quantile(biomass.last5yearmean, .25, na.rm=TRUE), \n                                                Median = median(biomass.last5yearmean),\n                                                UQ = quantile(biomass.last5yearmean, .75, na.rm=TRUE),\n                                                Max = max(biomass.last5yearmean),\n                                                Mean = mean(biomass.last5yearmean),\n                                                Percent.Below.Bpa = sum(below.bpa)/length(above.bpa),\n                                                Percent.Below.Blim = sum(below.blim)/length(below.blim)), by=\"StrategyName\"]\n    biomass.summary.by.strategy = appendVariableToDataTable(biomass.summary.by.strategy, igroup, \"GroupName\", beg=TRUE, end=FALSE)\n    summary.dt = rbind(summary.dt, biomass.summary.by.strategy)\n  }\n  \n  #finally save the table to csv\n  write.csv(summary.dt, file = paste(params$plot.path, \"Tables/biomass_5NoSummary.csv\", sep=\"\"))\n  \n  return(summary.dt)\n}\n\n# FUNCTION END  ===============================================================================================\n\n\n\n# TESTING START ===================================================================================================\n# TESTING END ===================================================================================================\n\n\n\n# FUNCTION CALLS START ===============================================================================================\n\ndt = CreateBiomassFiveNumSum()\n\n# FUNCTION CALLS END ===============================================================================================\n",
    "created" : 1491494441391.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3604635182",
    "id" : "C4630AF0",
    "lastKnownWriteTime" : 1491494609,
    "last_content_update" : 1491494609452,
    "path" : "C:/Users/Mark/Desktop/MSE_Plugin_Results_Plotting/Calc_Mean5YearBiomass_FiveNum_Sum.R",
    "project_path" : "Calc_Mean5YearBiomass_FiveNum_Sum.R",
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}