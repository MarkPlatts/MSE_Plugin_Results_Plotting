{
    "collab_server" : "",
    "contents" : "\n\n# FUNCTIONS START ==================================================================================================\n\n#get a list of target hcrs listed by strategy and group name\nLoadStrategies = function (hcr.folders, Target_or_Conservation){\n  strategies.table = getStrategyTable(hcr.folders)\n  if(Target_or_Conservation == \"Target\"){\n    strategies.table = filter(strategies.table, Target_or_Conservation==0)\n  } else if (Target_or_Conservation == \"Conservation\") {\n    strategies.table = filter(strategies.table, Target_or_Conservation==0)\n  }\n  return(strategies.table)\n  \n}\n\n# FUNCTIONS END ==================================================================================================\n\n\n# SCRIPT START  ===============================================================================================\n\nif(TRUE){\n\n  unique.groups = groupsWithHcr(hcr.folders, groups.for.f.or.biomass)\n  \n  strategies.table = LoadStrategies(hcr.folders, Target_or_Conservation = \"Target\")\n\n  dt.all = data.table()\n  \n  for(igroup in unique.groups)\n  {\n\n    #get the file in HCRQuota_Targ folder that are for \"AllFleets\"\n    realisedLandedF.file = GetFileName_ContainsStrings(FolderPath = paste(root.results, \"/RealisedLandedF/\", sep=\"\"), \n                                                 Strings = c(igroup), WithPath=T)\n\n    realised.landed.f = fread(realisedLandedF.file, skip=7, header=T)\n    \n    #Determine file is valid\n    if(!isNotAll(dt = realised.landed.f, col.data.starts = 4, val.to.check = -9999)) next\n    \n    #load the files and sum\n    realised.landed.f = calcLast5Year(realised.landed.f, \"realised.landed.f.last5yearsum\", 4, function.type = 2)\n    \n    #add a column with the group name - need this to merge with the strategy data.table\n    realised.landed.f = appendVariableToDataTable(dt=realised.landed.f, variable=igroup, variablename=\"GroupNameForF\", beg=TRUE, end=FALSE)\n\n    #merge the two together so that we can easily calculate the difference between two columns\n    dt = merge(x=realised.landed.f, y=strategies.table, by = c(\"StrategyName\", \"GroupNameForF\"), all.x = TRUE)\n    dt = cbind(dt,data.table(realf.maxf.diff = dt[,realised.landed.f.last5yearsum] - dt[,MaxF]))\n\n    #Check where the catch is greater than or less than the quota\n    dt[, \"RealisedLandedF.greater.than.maxF\"] = dt$realf.maxf.diff>=0\n    dt[, \"RealisedLandedF.less.than.maxF\"] = dt$realf.maxf.diff<0\n    \n    #For each strategy count how many models with realisedFs above and below maxFs and merge them together\n    NumberAbove = dt[,.(NumberAbove=sum(RealisedLandedF.greater.than.maxF)), by=.(StrategyName)]\n    NumberBelow = dt[,.(NumberBelow=sum(!RealisedLandedF.greater.than.maxF)), by=.(StrategyName)]\n    dt.counts.temp = merge(NumberAbove,NumberBelow, by = c(\"StrategyName\"))\n    \n    #Create new column that turns the counts into percentages\n    dt.counts.temp$PercentAbove = dt.counts.temp$NumberAbove/(dt.counts.temp$NumberAbove+dt.counts.temp$NumberBelow)*100\n    dt.counts.temp$PercentBelow = dt.counts.temp$NumberBelow/(dt.counts.temp$NumberAbove+dt.counts.temp$NumberBelow)*100\n    \n    #add column with groupname to differentiate after binding\n    dt.counts.temp = cbind(data.table(GroupNameForF = rep(igroup, dim(dt.counts.temp)[1])), dt.counts.temp)\n    \n    dt.counts.temp = merge(dt.counts.temp, strategies.table[,c(\"StrategyName\", \"GroupNameForF\", \"MaxF\")], by=c(\"GroupNameForF\", \"StrategyName\"))\n    \n    #bind them all together ready to be saved to csv\n    dt.all = rbind(dt.all, dt.counts.temp)\n    \n  }\n  \n  #finally save the table to csv\n  write.csv(dt.all, paste(root.plot, \"Tables/Percentage_RealisedLandedF_Above_Below_maxF.csv\", sep=\"\"))\n}\n\n# SCRIPT END  ===============================================================================================\n\n\n\n\n\n# TESTING START ===================================================================================================\n\nif(FALSE){\n  \n  print(getStrategyTable(hcr.folders))\n  \n}\n\n# TESTING END ===================================================================================================",
    "created" : 1494936969140.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "616929622",
    "id" : "6BB40894",
    "lastKnownWriteTime" : 1494938141,
    "last_content_update" : 1494938141291,
    "path" : "C:/Users/Mark/Desktop/Desktop etc/GAP/MSE_Plugin_Results_Plotting/Calc_Percent_RealisedF_Above_Below_FMax.R",
    "project_path" : "Calc_Percent_RealisedF_Above_Below_FMax.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}