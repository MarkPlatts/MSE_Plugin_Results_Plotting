{
    "collab_server" : "",
    "contents" : "source(\"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/R Code/Plotting Trajectories post Jan 2016/Plotting_Trajectores_Project_2016/share_tools.R\")\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nplot_fishing_trajectories <- function(params){\n  \n  #set the x axis values depending on what result type and whether plotting yearly or montly\n  if(any(params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ,params$MORT_HCRF_Cons,params$MORT_HCRF_Targ)){\n    TimeStepVals = get_timestep_vals(FALSE, params$StartProjection_Year, params$EndRun_Year)\n  } else if (any(params$MORT_REAL_LandF, params$MORT_REAL_DiscF, params$MORT_REAL_F, params$CATCH, params$LANDING, \n                 params$DISCARD)) {\n    TimeStepVals = get_timestep_vals(params$plot_each_timestep, params$StartProjection_Year, params$EndRun_Year)\n  }\n    g <- list.files()     # which groups are there?\n\n    if(!params$SAVE) pdf(file =paste(plot.path,\"\\\\OUTPUT_GROUP_FIGS\\\\\",TITLE,\" plots by group and strategy.pdf\",sep=\"\"),width=14,height=7,paper=\"a4r\")\n    \n    for(G in g){\n\n      FILENAME <- substr(G,1,nchar(G)-4)\n      print(FILENAME)\n      \n      #stopifnot(FILENAME!=\"HCR_F_Cons_Nephrops_GroupsNo55\") \n      if (any(params$MORT_REAL_F,params$MORT_REAL_LandF,params$MORT_REAL_DiscF, params$MORT_HCRF_Cons,params$MORT_HCRF_Targ)){\n        if(params$COMPARE_STRATEGIES && !FileIsForACompareGroup(params, FILENAME)) next\n      } else if (any(params$CATCH,params$DISCARD,params$LANDING,params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ)) {\n        if (params$COMPARE_STRATEGIES && !FileIsForACompareGroupFleet(params, FILENAME)) next\n      }\n      \n      #Need to figure out what to do about types that are yearly but don't have yearly in them\n      if(any(params$CATCH,params$DISCARD,params$LANDING,params$MORT_REAL_F,params$MORT_REAL_LandF,\n             params$MORT_REAL_DiscF)){\n        if(IsIncorrectFileType_YearlyMonthly(FILENAME, params$Plot_yearly_files)) next\n      }\n\n      DontPlot = TRUE\n      for(iGroup in params$Groups2Plot){\n        if (length(grep(paste(\"_\",iGroup, sep=''), G, fixed=TRUE))==1) {\n          DontPlot=FALSE\n          break\n        }\n      }\n      if (DontPlot==TRUE) next\n      \n      if(any(params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ,params$CATCH,params$DISCARD,params$LANDING)){\n        #Checks whether the fleet of this file has been chosen at top of script to be plotted\n        DontPlot = TRUE\n        for(iFleet in params$Fleets2Plot){\n          if (length(grep(paste(iFleet,\".csv\", sep=''), G, fixed=TRUE))==1) {\n            DontPlot=FALSE\n            break\n          }\n        }\n        if (DontPlot==TRUE) next\n      }\n      \n      groupdat <- read.table(file=paste(G,sep=''),skip=7, header = TRUE, fill = TRUE,sep=\",\",as.is =T)\n      #if all values in the file are -9999 then we need to skip plotting it\n      if(any(params$MORT_HCRF_Cons,params$MORT_HCRF_Targ)){\n        testvaliddata<- groupdat[, 5:ncol(groupdat)]\n        if(length(as.matrix(testvaliddata))*-9999==sum(testvaliddata)) {next}\n      }\n      \n      if(any(params$MORT_REAL_F,params$MORT_REAL_LandF,params$MORT_REAL_DiscF)){\n        testvaliddata<- groupdat[, 5:ncol(groupdat)]\n        if(sum(testvaliddata)==0) {next}\n      }\n      \n      if(any(params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ)){\n        testvaliddata<- groupdat[, 6:ncol(groupdat)]\n        if(length(as.matrix(testvaliddata))*-9999==sum(testvaliddata)) {next}\n      }\n      if (params$SAVE) {\n        if(!params$COMPARE_STRATEGIES) {\n          if(any(params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ,params$CATCH,params$DISCARD,params$LANDING)){\n            png(filename = paste(plot.path,\"\\\\OUTPUT_GEARSGROUPSbySTRATEGIES\\\\\",FILENAME,\"_.png\",sep=\"\"), res=900, width=10, height=4, units='in')              \n          } else {\n            png(filename = paste(plot.path,\"\\\\OUTPUT_GROUP_FIGS\\\\\",FILENAME,\"_.png\",sep=\"\"), res=900, width=10, height=4, units='in')              \n          }\n        } else {\n          png(filename = paste(plot.path,\"\\\\OUTPUT_COMPARE_STRATS\\\\\",FILENAME,\"_COMP.png\",sep=\"\"), res=900, width=10, height=4, units='in')\n        }\n      }\n      \n      \n      print(paste(\"The number of open devices is\",length(dev.list())))\n      #if(length(dev.list())>1) browser()\n      \n      if(any(params$MORT_REAL_F,params$MORT_REAL_LandF,params$MORT_REAL_DiscF)){\n        groupdat <- groupdat[,-which(names(groupdat)==\"ResultType\")]\n        if(params$plot_each_timestep==F && !params$Plot_yearly_files){\n          groupdat<-groupdat[,c(2:3,3+seq(1,params$Projected_NYears*12,12))] # TAKE JANS\n        } else if(params$plot_each_timestep && !params$Plot_yearly_files) {\n          groupdat<-groupdat[,c(2:(3+params$Projected_NYears*12))]\n        } else {\n          groupdat<-groupdat[,c(2:(3+params$Projected_NYears))]\n        }\n        \n      }\n      \n      if(any(params$MORT_HCRF_Cons,params$MORT_HCRF_Targ)){\n        groupdat <- groupdat[,-which(names(groupdat)==\"ResultType\")]\n        groupdat<-groupdat[,2:ncol(groupdat)] # TAKE JANS\n      }\n      \n      if(any(params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ)){\n        groupdat <- groupdat[,-which(names(groupdat)==\"ResultType\")]\n        groupdat<-groupdat[,2:ncol(groupdat)]\n      }\n      \n      if(any(params$CATCH,params$DISCARD,params$LANDING)){\n\n        groupdat[,6:ncol(groupdat)] <- groupdat[,6:ncol(groupdat)]\n        \n\n        if(params$plot_each_timestep==F && !params$Plot_yearly_files){\n          groupdat<-groupdat[,c(1:5,5+seq(1,params$Projected_NYears*12,12))]\n        } else if (params$plot_each_timestep && !params$Plot_yearly_files){\n          groupdat<-groupdat[,c(1:(5+params$Projected_NYears*12))]\n        } else {\n          groupdat<-groupdat[,c(1:(5+params$Projected_NYears))]\n        }\n        \n      }\n      \n      #This code converts the data into percentiles and the mean and only these values are plotted and saved\n      PERCS<-MDNS<- LOWS<- UPPS<- MEANS<- data.frame(year=TimeStepVals,row.names =TimeStepVals)\n      \n      for(strat_i in 1:length(params$strats)){\n        \n        STRAT<-paste(params$strats[strat_i],sep=' ')\n        \n        if(params$COMPARE_STRATEGIES){\n          if(strat1name!=STRAT && strat2name!=STRAT) {\n            next\n          }\n        }\n        \n        #select subset of data\n        if(any(params$CATCH,params$DISCARD,params$LANDING)){\n          data2plot<- groupdat[groupdat$Strategy %in% STRAT,6:ncol(groupdat)] * 570000\n        }\n        \n        if(any(params$MORT_HCRF_Cons,params$MORT_HCRF_Targ)){\n          data2plot<- groupdat[groupdat$Strategy %in% STRAT, 3:ncol(groupdat)]\n          if(length(data2plot)*-9999==sum(data2plot)) {\n            next\n          }\n        }\n        \n        if(any(params$MORT_REAL_F,params$MORT_REAL_LandF,params$MORT_REAL_DiscF)){\n          data2plot<- groupdat[groupdat$Strategy %in% STRAT, 3:ncol(groupdat)]\n        }\n        \n        if(any(params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ)){\n          data2plot<- groupdat[groupdat$Strategy %in% STRAT, 4:ncol(groupdat)] * 570000\n        }\n        \n        if((nrow(data2plot)==0)) next\n        #quantiles for polygon plot\n        perc<-apply(data2plot,2, FUN=function(x){quantile(x,probs=c(0.025,0.5,0.975),na.rm=T)})\n        perc<-rbind(perc, apply(data2plot,2, FUN=mean) )\n        #save percs\n        LOWS<- cbind(LOWS,perc[1,]);   names(LOWS)[ncol(LOWS)]<-STRAT\n        MDNS<- cbind(MDNS,perc[2,]);   names(MDNS)[ncol(MDNS)]<-STRAT\n        UPPS<- cbind(UPPS,perc[3,]);   names(UPPS)[ncol(UPPS)]<-STRAT\n        MEANS<- cbind(MEANS,perc[4,]); names(MEANS)[ncol(MEANS)]<-STRAT\n        \n        PERC<-data.frame(t(perc))\n        names(PERC) <- c(paste(STRAT,\"LOW\"),paste(STRAT,\"MDN\"),paste(STRAT,\"UPP\"),paste(STRAT,\"MEAN\"))\n        PERCS<- cbind(PERCS, PERC)\n      }\n      \n      \n      #now summary plot\n      if(ncol(MEANS)==1) {\n        graphics.off()\n        next\n      }\n      if(sum(MEANS[,-1],na.rm=T)==0 & !any(params$MORT_REAL_F,params$MORT_REAL_LandF,params$MORT_REAL_DiscF) ) {\n        graphics.off()\n        next\n      }\n      par(mar=c(5.1, 4.1, 4.1, 15), xpd=TRUE)\n\n      if(params$PLOT_CONFIDENCE_INTERVALS){\n        plot(TimeStepVals,MEANS[,2],type='l',ylim=c(0,1.25*(max(MEANS[,-1],UPPS[,-1],na.rm=T))),lty=params$LTY[1],col=params$COL[1],ylab=params$YLAB,xlab=\"year\",font=20,lwd=params$lineweight)\n        for(i in 3:ncol(MEANS)) {\n          lines(TimeStepVals,MEANS[,i],lty=params$LTY[(i-1)],col=params$COL[(i-1)],lwd=params$lineweight)\n        }\n        for(i in 2:ncol(LOWS)) {\n          lines(TimeStepVals,LOWS[,i],lty=params$LTY[(i)],col=params$COL[(i-1)],lwd=params$lineweight*0.5)\n          lines(TimeStepVals,UPPS[,i],lty=params$LTY[(i)],col=params$COL[(i-1)],lwd=params$lineweight*0.5)\n        }\n      } else {\n        plot(TimeStepVals,MEANS[,2],type='l',ylim=c(0,1.25*(max(MEANS[,-1],na.rm = T))),lty=params$LTY[1],col=params$COL[1],ylab=params$YLAB,xlab=\"year\",font=20,lwd=params$lineweight)\n        for(i in 3:ncol(MEANS)) {\n          lines(TimeStepVals,MEANS[,i],lty=params$LTY[(i-1)],col=params$COL[(i-1)],lwd=params$lineweight)\n        }\n      }\n      Changed all the source paths from absolute path to relative path\n      if(any(params$MORT_REAL_F,params$MORT_REAL_LandF,params$MORT_REAL_DiscF)) title(c(\"F trajectory (mean) by strategy\",FILENAME),font.main=20)#only individual plots   \n      if(any(params$CATCH,params$DISCARD,params$LANDING))   title(c(\"Catch (mean) by strategy\",FILENAME),font.main=20)\n      if(any(params$MORT_HCRF_Cons,params$MORT_HCRF_Targ,params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ)) title(FILENAME,font.main=20)\n      \n      if(params$LEGEND){\n        if(params$COMPARE_STRATEGIES){\n          legend('bottomright',c(strat1name,strat2name),col = params$COL,lty =params$LTY,inset=c(-0.72,0),pt.cex = 1,cex=0.5,lwd=1,text.font=3)\n        } else {\n          legend('topright',params$strat,col = params$COL,lty =params$LTY,inset=c(params$legend_x_inset2,-0.2),lwd=1,text.font=3,pt.cex = 1,cex=0.5)\n        }\n      }\n      if (any(params$MORT_REAL_F,params$MORT_REAL_LandF,params$MORT_REAL_DiscF)){\n        if(params$WRITE) write.csv(PERCS[,-1],paste(plot.path,\"\\\\OUTPUT_FcatchBySTRATEGIES\\\\\",FILENAME,\".csv\",sep=\"\"))\n      } else if (any(params$CATCH,params$DISCARD,params$LANDING)) {\n        \n      } else if (any(params$MORT_HCRF_Cons,params$MORT_HCRF_Targ, params$QUOTA_HCRF_Cons,params$QUOTA_HCRF_Targ)) {\n        \n      }\n      \n      graphics.off()\n    }#next G\n    if(!params$SAVE) dev.off()\n  \n}\n\n",
    "created" : 1478613097866.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2647655796",
    "id" : "2C08C2FC",
    "lastKnownWriteTime" : 1478815814,
    "last_content_update" : 1478815814892,
    "path" : "C:/Users/Mark/Desktop/MSE_Plugin_Results_Plotting/F_Trajectories.R",
    "project_path" : "F_Trajectories.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}