{
    "collab_server" : "",
    "contents" : "source(\"C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/R Code/Plotting Trajectories post Jan 2016/Plotting_Trajectores_Project_2016/share_tools.R\")\n\n###Value Trajectories\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nplot_effort_trajectories <- function(params){\n  setwd(paste(params$RootPath,\"\\\\Effort\", sep=''))\n  \n  TimeStepVals = get_timestep_vals(params$plot_each_timestep, params$StartRun_Year, params$EndRun_Year)\n  \n  g <- list.files()     # which groups are there?\n  #gnum <- 2    #g[6] is \"Cod (adult)_GroupNo14.csv\"\n  #FILENAME <- substr(g[gnum],1,nchar(g[gnum])-4)\n  #groupdat <- read.csv(g[gnum],skip=6, head=T)\n  \n  SUMMARYPLOT<-T\n  SAVE_ONLY_SUMMARY<-F\n  \n  \n  ###Fleet Trajectories\n  \n  for (G in g){\n    \n    #Get the filename to be used to check whether yearly in name, to name files of plots and to add text to plots\n    FILENAME = substr(G,1,nchar(G)-4)\n    \n    #Check whether we should plot the yearly files or the monthly files\n    if(IsIncorrectFileType_YearlyMonthly(FILENAME, params$Plot_yearly_files)) next\n    \n    #Checks whether the fleet is designated to be plotted\n    DontPlot = TRUE\n    for(iFleet in params$Fleets2Plot){\n      if (length(grep(paste(iFleet,\".csv\", sep=''), G, fixed=TRUE))==1) {\n        DontPlot=FALSE\n        break\n      }\n    }\n    if (DontPlot==TRUE) next\n    \n    \n    #Load the data from the file represented by G\n    effortdat<-read.csv(G,skip=6, head=T)\n    #Get the name of the fleet\n    FLEET<- as.character(unique(effortdat$FleetName))\n    \n    #timeseries of FLEET effort by FleetNumber 1:12 for the 10 strategies\n    if(!params$plot_each_timestep & !params$Plot_yearly_files) effortdat<-effortdat[,c(1:3,4+seq(1,params$nyrs*12,12))] \n    names(effortdat)[names(effortdat)==\"StrategyName\"]  <- \"Strategy\"\n    \n    graphics.off()\n    \n\n    \n    \n    #effortdat <- effort[effort$FleetName == GROUP,c(1,3:ncol(effort))]\n\n    PERCS<-MDNS<- LOWS<- UPPS<- MEANS<- data.frame(year=TimeStepVals,row.names =TimeStepVals)\n    if(!SUMMARYPLOT) par(mfrow=c(3,4),mar=c(2,2,4,1),oma=c(1,1,3,1))\n    if(SAVE_ONLY_SUMMARY) par(mfrow=c(2,1),mar=c(1,4,3,1),oma=c(1,1,3,1))\n    \n    if (params$SAVE) {\n      if(!params$COMPARE_STRATEGIES) {\n        png(filename = paste(plot.path, \"\\\\OUTPUT_GEARSbySTRATEGIES\\\\\",FILENAME,\"_PERCS.png\",sep=\"\"), res=900, width=8, height=4, units='in')\n      } else {\n        png(filename = paste(plot.path,\"\\\\OUTPUT_COMPARE_STRATS\\\\\",FILENAME,\"_COMP.png\",sep=\"\"), res=900, width=8, height=4, units='in')\n      }\n    }\n    \n    for(strat_i in 1:length(params$strats)){\n      \n      STRAT<-paste(params$strats[strat_i],sep=' ')\n      \n      if(params$COMPARE_STRATEGIES){\n        if(strat1name!=STRAT && strat2name!=STRAT) next\n      }\n      \n      #select subset of data\n      data2plot<- effortdat[effortdat$Strategy %in% STRAT,5:ncol(effortdat)]\n      \n      #quantiles for polygon plot\n      perc<-apply(data2plot,2, FUN=function(x){quantile(x,probs=c(0.025,0.5,0.975),na.rm=T)})\n      #for(i in 1:2) lines(params$StartRun_Year:End,perc[i,],lwd=4,col='dark blue',lty=1) \n      perc<-rbind(perc, apply(data2plot,2, FUN=mean) )\n      \n      #           if(!SUMMARYPLOT){#do all\n      #             #grey poly\n      #             if(strat_i==1) YMAX<- 1.25*(max(perc))\n      #             plot(params$params$StartRun_YearRun_Year:(params$EndRun_Year-1),perc[4,],type='l',lwd=2,ylim=c(0,YMAX),\n      #                  main=STRAT,xlab='years',ylab=\"relative effort (mean)\")\n      #             polygon(c(params$params$StartRun_YearRun_Year:(params$EndRun_Year-1),params$StartRun_Year:(params$EndRun_Year-1)), c(perc[1,],perc[3,ncol(perc):1]),\n      #                     col=c(\"grey\"), border=c(\"grey\"), lwd=1, lty=c(\"solid\"))\n      #             # add heavy mean line\n      #             lines(params$StartRun_Year:(params$EndRun_Year-1),perc[4,],lwd=2,col=COL[strat_i],lty=LTY[strat_i])\n      #           }\n      \n      #save percs\n      \n      LOWS<- cbind(LOWS,perc[1,]);   names(LOWS)[ncol(LOWS)]<-STRAT\n      MDNS<- cbind(MDNS,perc[2,]);   names(MDNS)[ncol(MDNS)]<-STRAT\n      UPPS<- cbind(UPPS,perc[3,]);   names(UPPS)[ncol(UPPS)]<-STRAT\n      MEANS<- cbind(MEANS,perc[4,]);   names(MEANS)[ncol(MEANS)]<-STRAT\n      \n      PERC<-data.frame(t(perc))\n      names(PERC) <- c(paste(STRAT,\"LOW\"),paste(STRAT,\"MDN\"),paste(STRAT,\"UPP\"),paste(STRAT,\"MEANS\"))\n      PERCS<- cbind(PERCS, PERC)\n      \n    } \n    if(!SUMMARYPLOT) mtext(FILENAME, outer=T,side=3,font=2)\n    \n    #summary plot\n    par(mar=c(5.1, 4.1, 4.1, 12), xpd=TRUE)\n    \n    plot(TimeStepVals,MEANS[,2],type='l',ylim=c(0,1.25*(max(MEANS[,-1]))),col=params$COL[1],lty=params$LTY[1],ylab=\"relative effort\",xlab=\"year\",font=20)\n    for(i in 3:ncol(MEANS)) {\n      lines(TimeStepVals,MEANS[,i],lty=params$LTY[(i-1)],col=params$COL[(i-1)], lwd=1)\n    }\n    if(params$SAVE & SUMMARYPLOT)  title(FILENAME,font.main=20)\n    \n    if(params$PLOT_CONFIDENCE_INTERVALS){\n      plot(TimeStepVals,MEANS[,2],type='l',ylim=c(0,1.25*(max(MEANS[,-1],UPPS[,-1]))),lty=params$LTY[1],col=params$COL[1],ylab=\"relative effort (t)\",xlab=\"year\",font=20,lwd=params$lineweight)\n      for(i in 3:ncol(MEANS)) {\n        lines(TimeStepVals,MEANS[,i],lty=params$LTY[(i-1)],col=params$COL[(i-1)],lwd=params$lineweight)\n      }\n      for(i in 2:ncol(LOWS)) {\n        lines(TimeStepVals,LOWS[,i],lty=params$LTY[(i)],col=params$COL[(i-1)],lwd=params$lineweight*0.5)\n        lines(TimeStepVals,UPPS[,i],lty=params$LTY[(i)],col=params$COL[(i-1)],lwd=params$lineweight*0.5)\n      }\n    } else {\n      plot(TimeStepVals,MEANS[,2],type='l',ylim=c(0,1.25*(max(MEANS[,-1]))),lty=params$LTY[1],col=params$COL[1],ylab=\"relative effort (t)\",xlab=\"year\",font=20,lwd=params$lineweight)\n      for(i in 3:ncol(MEANS)) {\n        lines(TimeStepVals,MEANS[,i],lty=params$LTY[(i-1)],col=params$COL[(i-1)],lwd=params$lineweight)\n      }\n    }\n    \n    if(params$LEGEND){\n      if (params$COMPARE_STRATEGIES) {\n        legend('topright',c(strat1name,strat2name),col = params$COL,lty =params$LTY,inset=c(params$legend_x_inset2,0),lwd=1,text.font=3,pt.cex = 1,cex=0.5)\n      } else {\n        #legend('topright',params$strats,col = params$COL,lty =params$LTY,inset=c(-0.5,0),lwd=1,text.font=3,pt.cex = 1,cex=0.5)\n        legend('topright',params$strats,col = params$COL,lty =params$LTY,inset=c(params$legend_x_inset2,-0.2),lwd=1,text.font=3,pt.cex = 1,cex=0.5)\n      }\n      #legend(\"topright\",legend=params$strats,inset=c(-0.2,0), pch=c(1,3), title=\"Group\")\n      #legend('bottomright',params$strats,col = params$COL,lty =params$LTY,inset=c(-0.4,0),cex=0.65,lwd=1,text.font=3)\n    }\n    \n    if(params$SAVE & !SUMMARYPLOT){\n      if(params$LEGEND) {plot(0,0,axes=F,col=\"white\",ylab=\"\",xlab=\"\")\n        legend('bottomright',params$strats,col = params$COL,lty =params$LTY,inset=0,lwd=1,text.font=20,pt.cex = 1,cex=0.5)}\n      title(\"effort trajectory (mean) by strategy\")\n      #savePlot(paste(\"OUTPUT_GEARSbySTRATEGIES//\",FILENAME,\"_PERCS.png\",sep=\"\"),type='png')\n    }\n    \n    if(SAVE_ONLY_SUMMARY){\n      plot(0,0,axes=F,col=\"white\",ylab=\"\",xlab=\"\")\n      legend('topright',params$strats,col = params$COL,lty =params$LTY,inset=0,lwd=1,text.font=20,pt.cex = 1,cex=0.5)\n      #savePlot(paste(\"OUTPUT_GEARSbySTRATEGIES//\",FILENAME,\"_SUMMARY.pdf\",sep=\"\"),type='pdf')\n    }\n    if(!params$SAVE & !SUMMARYPLOT) title(FILENAME,font.main=20)\n    \n    if(params$WRITE) write.csv(PERCS[,-1],paste(\"OUTPUT_GEARSbySTRATEGIES//\",FILENAME,\"_PERCS.csv\",sep=\"\"))\n    \n    #         if(params$SAVE & SUMMARYPLOT & !SAVE_ONLY_SUMMARY){  title(FILENAME,font.main=20)\n    #           mtext(\"effort trajectory (median) by strategy\",side=3,outer=T,font=20)\n    #           plot(0,0,axes=F,col=\"white\",ylab=\"\",xlab=\"\")\n    #           legend('bottomright',params$strats,col = params$COL,lty =params$LTY,inset=0,cex=.6,lwd=1,text.font=20)\n    #           #savePlot(paste(\"OUTPUT_GEARSbySTRATEGIES//FLEET_summary.pdf\",sep=\"\"),type='pdf')\n    #         }\n    \n    graphics.off()\n    \n  } \n}",
    "created" : 1478613098734.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1686951696",
    "id" : "41CC6533",
    "lastKnownWriteTime" : 1478618374,
    "last_content_update" : 1478618374239,
    "path" : "C:/Users/Mark/Dropbox/GAP2_MSE Plugin2/R Code/Plotting Trajectories post Jan 2016/Plotting_Trajectores_Project_2016/Effort_Trajectories.R",
    "project_path" : "Effort_Trajectories.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}